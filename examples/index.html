<!DOCTYPE html>
<html>

<head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="https://raw.githubusercontent.com/jgallen23/jquery-builder/0.7.0/dist/1.11.1/jquery-css-deprecated-dimensions-effects-event-alias-offset-wrap.min.js" type="text/javascript"></script> -->
    <script src="../xGridV2.js" type="text/javascript"></script>
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
    <link rel="stylesheet" href="../xGridV2.css">
    <link rel="stylesheet" src="legal">

    <link rel="stylesheet" href="http://reallatas.myftp.org:1515/_projeto_real/superClass/mofo-v2/mofoV2.css">
    <script src="http://reallatas.myftp.org:1515/_projeto_real/superClass/mofo-v2/mofoV2.js"
        type="text/javascript"></script>



    <style>
        body {
            /* background: #083952; */
            color: #f8f8f8;
            font: 12px/1.3 'Lucida Sans Unicode', 'Trebuchet MS', Arial, Helvetica;
            background: #546e7a;
        }
    </style>

</head>

<body>

    <div class="campos">
        <span>Descrição Produto</span>
        <input type="text" name="DESC_PRODUTO">
        <span>Num Fabricante</span>
        <input type="text" name="NUM_FABRICANTE">
        <span>End Estoque</span>
        <input type="text" name="END_ESTOQUE">

        <!-- <input type="checkbox" name="casado"><span>Sim</span> -->
        <!-- <span>img</span>
        <img src="" alt="teste" name="img" height="15" /> -->
        <!-- <br>
        <span>sexo</span>
        <input type="radio" name="genero" value="M" /> Man
        <input type="radio" name="genero" value="F" /> Woman
        <input type="radio" name="genero" value="D" /> Woman -->

        <span>Unidade</span>
        <select name="UNIDADE">
            <option value="PC">Peça</option>
            <option value="JG">Jogo</option>
            <option value="UN">Unidade</option>
        </select>

        <span>Carro</span>
        <textarea name="CARRO"></textarea>
    </div>
    <hr>

    <div id="theGrid"></div>
    <div id="myGridFrame"></div>




    <script>
        var json = [{
            name: '#################################',
            login: 'Meire <br>Legal',
            cpf: '444',
            old: 40,
            tel: '845-453',
            qto: 13,
            cidade: 'SIA',
            casado: 1
        }, {
            name: 'Kallebe Alves',
            login: 'Kallebe',
            cpf: '654654',
            old: 16,
            tel: '888-345',
            qto: 98,
            cidade: 'Recando da Emas',
            casado: 0

        }, {
            name: 'Alves Xico',
            login: 'Alves',
            cpf: '11577',
            old: 37,
            tel: '466-664',
            qto: 8,
            cidade: 'Taguatinga',
            casado: 0
        }, {
            name: 'Sousa Alves',
            login: 'Sousa',
            cpf: '874465',
            old: 22,
            tel: '858-999',
            qto: 21,
            cidade: 'Setor O',
            casado: 0
        }, {
            name: 'Kalline Rocha',
            login: 'Kalline',
            cpf: '1111',
            old: 11,
            tel: '787-995',
            qto: 11,
            cidade: 'Gura',
            casado: 1
        }, {
            name: 'Francisco Alves',
            login: 'Francisco',
            cpf: '778.583.951-48',
            old: 37,
            tel: '999-999',
            qto: 7,
            cidade: 'Brasilia',
            casado: 1
        }, {
            name: 'Meire Clecia',
            login: 'Meire <br>Legal',
            cpf: '222',
            old: 40,
            tel: '845-453',
            qto: 13,
            cidade: 'SIA',
            casado: 1
        }, {
            name: 'Kallebe Alves',
            login: 'Kallebe',
            cpf: '654654',
            old: 16,
            tel: '888-345',
            qto: 98,
            cidade: 'Recando da Emas',
            casado: 1
        }, {
            name: 'Alves Xico',
            login: 'Alves',
            cpf: '11577',
            old: 37,
            tel: '466-664',
            qto: 8,
            cidade: 'Taguatinga',
            casado: 1
        }, {
            name: 'Sousa Alves',
            login: 'Sousa',
            cpf: '874465',
            old: 22,
            tel: '858-999',
            qto: 21,
            cidade: 'Setor O',
            casado: 1
        }, {
            name: 'Kalline Rocha',
            login: 'Kalline',
            cpf: '1111',
            old: 11,
            tel: '787-995',
            qto: 11,
            cidade: 'Gura',
            casado: 1
        }, {
            name: 'Francisco Alves',
            login: 'Francisco',
            cpf: '778.583.951-48',
            old: 37,
            tel: '999-999',
            qto: 7,
            cidade: 'Brasilia',
            casado: 1
        }, {
            name: 'Meire Clecia',
            login: 'Meire <br>Legal',
            cpf: '222',
            old: 40,
            tel: '845-453',
            qto: 13,
            cidade: 'SIA',
            casado: 1
        }, {
            name: 'Kallebe Alves',
            login: 'Kallebe',
            cpf: '654654',
            old: 16,
            tel: '888-345',
            qto: 98,
            cidade: 'Recando da Emas',
            casado: 1
        }, {
            name: 'Alves Xico',
            login: 'Alves',
            cpf: '11577',
            old: 37,
            tel: '466-664',
            qto: 8,
            cidade: 'Taguatinga',
            casado: 1
        }, {
            name: 'Sousa Alves',
            login: 'Sousa',
            cpf: '874465',
            old: 22,
            tel: '858-999',
            qto: 21,
            cidade: 'Setor O',
            casado: 1
        }, {
            name: 'Kalline Rocha',
            login: 'Kalline',
            cpf: '1111',
            old: 11,
            tel: '787-995',
            qto: 11,
            cidade: 'Gura',
            casado: 1
        }, {
            name: 'Francisco Alves',
            login: 'Francisco',
            cpf: '778.583.951-48',
            old: 37,
            tel: '999-999',
            qto: 7,
            cidade: 'Brasilia',
            casado: 1
        }];

        xGridV2.setNotFound('not Found')
        xGridV2.setPrintHead('<div>Minha cabeça</div>')

        function reveter(value) {
            return value.split('').reverse('').join('')
        }


        const theGrid = new xGridV2.create({
            el: '#theGrid',
            height: 300,
            // width: 800,
            count: true,
            // heightLine: 50,
            // setfocus: 1,
            // theme: 'x-darkV2',
            theme: 'x-opacite',
            onSelectLine: (r) => {

            },
            filter: {
                // filterBegin: false, //quando true ele pesquisa igual a palavra
                // concat: {
                //       fields: ['DESC_PRODUTO', 'MARCA'],
                //       condicional: 'AND'
                //   },
                fieldByField: {
                    condicional: 'AND'
                }
            },
            onKeyDown: {
                13: (ln, e) => {
                    console.log(ln);
                    console.log('o Enter ta funcionado')
                },
                'ctrl+13': (objectLine, e) => {
                    console.log('ctrl+enter pressionado')
                },
            },
            enter: () => {
                theGrid.focusField()
                theGrid.disable()
                theGrid.disabledBtnsSalvarCancelar()
            },
            columns: {
                'Nº Fabricante': {
                    dataField: 'NUM_FABRICANTE',
                    width: '10%'
                },
                'Marca': {
                    dataField: 'MARCA',
                    width: '10%'
                },
                'FT': {
                    dataField: 'FOTO',
                    width: '3%',
                    style: 'text-align: center',
                },
                'Descrição Produto': {
                    dataField: 'DESC_PRODUTO',
                },
                'C.G': {
                    dataField: 'CURVA_ABC_G',
                    width: '3%',
                    style: 'text-align: center'
                },
                'UN': {
                    dataField: 'UNIDADE',
                    width: '4%',
                    style: 'text-align: center'
                },
                'Carro': {
                    dataField: 'CARRO',
                    width: '15%',
                },
                'Qto': {
                    dataField: 'QUANTIDADE',
                    width: '5%',
                    style: 'text-align: center',
                },
                'Preço': {
                    dataField: 'VALOR_VENDA',
                    width: '8%',
                    style: 'text-align: right'
                }
            },
            compare: {
                junta: (r) => {
                    return r.value + ' ' + r.COD_PRODUTO
                }
            },
            sideBySide: {
                el: '.campos',
                // tabToEnter: true,
                render: {
                    'NUM_FABRICANTE': reveter
                },
                compare: {
                    DESC_PRODUTO: 'junta'
                },
                duplicity: {
                    dataField: ['NUM_FABRICANTE', 'DESC_PRODUTO', 'END_ESTOQUE'],
                    execute: (r) => {
                        console.log(r);
                        // getServidor
                        // repostar
                        let valueBanco = 'valor que vem do banco de dados'

                        if (r.value != valueBanco) {
                            theGrid.showMessageDuplicity(r.text + ' já esta em uso ok')
                            return false
                        }
                    }
                },
                frame: {
                    el: '#myGridFrame',
                    class: 'texte novo',
                    style: 'text-align: center;',
                    print: {
                        html: '<i class="fa fa-edit"></i> imprimir',
                        style: 'background: red;',
                        class: 'mybtn',
                        click: () => {
                            theGrid.print()
                        }
                    },
                    insert: {
                        html: 'Novo',
                        state: xGridV2.state.insert,
                        click: (ln, e) => {
                            console.warn(e, 'novo');
                            /*esse retorno falso bloquea a açao do do click*/
                            return false
                        }
                    },
                    editar: {
                        html: 'Alterar',
                        state: xGridV2.state.update,
                        click: () => {
                            console.warn('Alterar')
                            theGrid.focusField('qto')
                        }
                    },
                    delete: {
                        html: 'Excluir',
                        state: xGridV2.state.delete,
                        click: () => console.warn('Excluir')
                    },
                    salvarBtn: {
                        html: 'Salvar',
                        state: xGridV2.state.save,
                        click: () => {
                            theGrid.enable()
                            theGrid.focus()
                            console.warn('salvar')
                        }
                    },
                    cancel: {
                        html: 'Cancel',
                        state: xGridV2.state.cancel,
                        click: () => {
                            theGrid.enable()
                            console.warn('cancelar')
                        }
                    }
                }
            },
            query: {
                // endScroll: 0.5,
                execute: (offset, param) => {
                    let formData = new FormData();
                    formData.append('id_sociedade', '10')
                    formData.append('call', 'getProdutos')
                    formData.append('param[id_carro]', '9999')
                    formData.append('param[get]', 'getProdutosNewLoc')
                    formData.append('param[vercao]', 'false')
                    formData.append('param[maxItem]', '30')

                    formData.append('param[desc_produto]', param.desc_produto)
                    formData.append('param[skip]', offset)

                    // fetch('http://www.realacessorios.com.br/balcao/servidor/per.balcao.php', {
                    fetch('http://reallatas.myftp.org:2424/balcao/servidor/per.balcao.php', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        // .then(json => grid.querySourceAdd(json))
                        .then((json_) => {
                            theGrid.querySourceAdd(json_)
                            console.log(theGrid.sumDataField('VALOR_VENDA'))
                            return json_
                        })


                }
            }

        })


        function tio(a) {
            console.log(a);
        }


        theGrid.load()
        theGrid.queryOpen({ desc_produto: 'FAROL LD' })

    </script>




</body>

</html>